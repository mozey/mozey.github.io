<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" prefix="og: http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#"><!--<![endif]-->

    <head>
                <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="author" content="Christiaan van Zyl">
        <meta name="keywords" content="awesome, definitely">
	
        <meta property="og:site_name" content="mozey.co">
        <meta property="og:title" content="mozey.co">
        <meta property="og:url" content="http://mozey.co/post/apache2-oom/">
        <meta property="og:description" content="">
    
        <meta property="og:type" content="article" />
        <meta property="og:article:author" content="Christiaan van Zyl" />
        <meta property="og:article:published_time" content="2015-08-01T00:00:00Z" />
    
        <meta name="generator" content="Hugo 0.15" />
        <title>apache2 oom &middot; mozey.co </title>
        <link rel="canonical" href="http://mozey.co/" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="">
        <link rel="stylesheet" type='text/css' href="http://mozey.co/css/main.css"/>
        <link rel="stylesheet" type='text/css' href="http://mozey.co/css/custom.css"/>
        <link href='http://mozey.co/css/montserrat.css' rel='stylesheet' type='text/css'>
        <link href="http://mozey.co/css/font-awesome.css" rel="stylesheet">
        <script src="http://mozey.co/js/jquery-1.10.2.min.js"></script>
        <link rel="icon" href="http://mozey.co/favicon.ico">
    </head>
<body>
<!--[if lt IE 7]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chrome/‎">install Google Chrome</a> to experience this site.</p><![endif]-->

    <header id="site-header">
        <div class="container">
            <a href="http://mozey.co/" alt="mozey.co"><h1 class="blog-title heading">mozey.co</h1></a>
            <p class="blog-description"></p>
        </div>
    </header>
<main class="content" role="main">
	<div class="container">
		<article class="post">
	<header class="post-header">
        <h3 class="p-post-title">apache2 oom</h3>
    </header>

    <section class="post-content">
        

<p><a href="http://monicalent.com/blog/2013/03/27/avoiding-the-oom-killer-by-limiting-the-number-of-apache2-processes/">Avoiding the OOM Killer by limiting the number of Apache2 processes and clients</a></p>

<p>&ldquo;Out of memory: kill process&hellip;&rdquo;</p>

<h3 id="apache-memory-usage-has-to-be-adjusted-for-ec2-micro-instances:03912ccfe2f74e4423e8012c33650078">Apache memory usage has to be adjusted for EC2 micro instances</h3>

<p>View processes sorted by memory usage</p>

<pre><code>echo &amp;&amp; echo -e 'PID \t%MEM \tSTART \tTIME \tCOMMAND' &amp;&amp; \
ps aux | awk '{print $2, &quot;\t&quot;$4, &quot;\t&quot;$9, &quot;\t&quot;$10, &quot;\t&quot;$11}' | sort -k2rn | head -n 15
</code></pre>

<p>Determine if apache2 is running as prefork or worker</p>

<pre><code>apache2 -l
</code></pre>

<p>Adjust the config file</p>

<pre><code>sudo vi /etc/apache2/apache2.conf

&lt;IfModule mpm_prefork_module&gt;
    StartServers 2
    MinSpareServers 2
    MaxSpareServers 5
    MaxClients 40
    MaxRequestsPerChild 0
&lt;/IfModule&gt;
</code></pre>

<p>StartServers</p>

<pre><code>The number of server processes (as seen when we run ps aux or top) 
that apache starts automatically.
</code></pre>

<p>MinSpareServers</p>

<pre><code>The minimum number of server processes apache will keep running in reserve, 
so they can be used as needed.
</code></pre>

<p>MaxSpareServers</p>

<pre><code>The maximum number of server processes apache will keep running in reserve. 
Any processes in excess of this will be killed.
</code></pre>

<p>MaxClients</p>

<pre><code>The maximum number of requests (GET, POST, etc.) that can be fielded at the same time. 
MaxKeepAliveRequests, earlier in this file, determines how many requests each connection 
can make before it has to re-establish. While keeping these numbers high is good for performance 
for your end-user, it’s bad if you have a baby-sized server like me.
</code></pre>

<p>MaxRequestsPerChild</p>

<pre><code>Number of requests a child process will handle before terminating.
</code></pre>

    </section>

    <hr>

    <footer class="post-footer">
        <section class="f-1">
            
            <section class="author">
                <p>Words by Christiaan van Zyl</p>
            </section>
            
            
            <p class="f-post-time"><time datetime="2015-08-01T00:00:00Z">August 1, 2015</time></p>
        </section>
                        
        <section class="f-2">
            <section class="share">
                <span>Share:
                <a class="icon-twitter" href="http://twitter.com/share?text=apache2%20oom&url=http%3a%2f%2fmozey.co%2fpost%2fapache2-oom%2f"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmozey.co%2fpost%2fapache2-oom%2f"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2fmozey.co%2fpost%2fapache2-oom%2f"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="fa fa-google-plus"></i>
                </a>
                </span>
            </section>

            
        </section>
                        
    </footer>
</article>
	</div>
</main>
    <footer id="site-footer">
        <div class="container">
            <a href="http://mozey.co/index.xml" title="Get the RSS feed"><span class="tooltip"><i class="fa fa-rss"></i></span></a>
            <section>&copy; <a href="http://mozey.co/">Christiaan van Zyl</a> 2015 | All rights reserved</section>
        </div>
    </footer>

    <script type="text/javascript" src="http://mozey.co/js/fittext.js"></script>
    <script type="text/javascript">
      $(".heading").fitText();
    </script>


</body>
</html>